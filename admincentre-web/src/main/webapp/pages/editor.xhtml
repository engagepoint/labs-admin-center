<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:uib="http://engagepoint.com/uib"
    template="/WEB-INF/templates/default.xhtml">

    <ui:define name="page">

        <h:form id="preferencesForm">
            <br/>
            <h2><h:outputText value="#{trans.prefAdm}"/></h2>

            <p:menuButton value="Options" id="Options" >
                <p:menuitem value="Export" id="export"
                            icon="ui-icon-disk"
                            ajax="false"
                            actionListener="#{tempController.onExportZip}">
                    <p:fileDownload value="#{fileController.downloadFile}"/>
                </p:menuitem>
                <p:menuitem value="Import"
                            update="ImportDialog"
                            icon="ui-icon-arrowrefresh-1-w"
                            oncomplete="uploadXML.show()"/>
            </p:menuButton>

            <p:dialog id="ImportDialog"
                      header="Import Dialog"
                      widgetVar="uploadXML"
                      modal="true" height="200" width="800">
                <p:fileUpload value="#{fileController.uploadFile}"
                              fileUploadListener="#{tempController.onImportZip}"
                              multiple="true"
                              oncomplete="uploadXML.hide()"/>

            </p:dialog>

            <ui:remove>
                <p:commandButton value="Configuration" oncomplete="confDialog.show()">
                </p:commandButton>

                <!--Config dialog-->
                <p:dialog id="confDialog"
                          header="Configure Dialog"
                          widgetVar="confDialog"
                          position="center, center"
                          showEffect="fade"
                          modal="true"
                          closable="false">

                    <f:facet name="header">#{trans.file}</f:facet>
                    <h:outputText value="#{doc.name}" />

                    <h:outputLabel value="Channel: " />
                    <p:inputText  value="#{configBean.channel}" style="font-weight:bold" />

                    <h:outputLabel value="Mode" />
                    <p:inputText  value="#{configBean.mode}" style="font-weight:bold" />

                    <h:outputLabel value="Cluster " />
                    <p:inputText  value="#{configBean.cluster}" style="font-weight:bold" />

                    <h:outputLabel value="Base Path" />
                    <p:inputText  value="#{configBean.basePath}" style="font-weight:bold" />
                    <br/>
                    <br/>
                    <p:commandButton
                        id="confOkButton"
                        value="Ok"
                        styleClass="ml20"
                        style="float:right"
                        ajax="false"
                        oncomplete="delDialog.hide()"/>

                    <h:outputText value="    "/>

                    <p:commandButton
                        id="confCancelButton"
                        value="Cancel"
                        styleClass="secondary"
                        style="float: right"
                        action="cancel"
                        update="treeTable"
                        oncomplete="delDialog.hide()"/>

                </p:dialog>
            </ui:remove>

            <p:treeTable id="treeTable"
                         value="#{documentsController.root}"
                         var="doc">
                <f:facet name="header">#{trans.propViewer}</f:facet>
                <p:column style="width:35%">
                    <f:facet name="header">#{trans.file}</f:facet>
                    <h:outputText value="#{doc.name}" />
                </p:column>

                <p:column style="width:35%">
                    <f:facet name="header">#{trans.value}</f:facet>
                    <h:outputText value="#{doc.value}"/>
                </p:column>
                <p:column style="width:15%">
                    <f:facet name="header">#{trans.type}</f:facet>
                    <h:outputText value="#{doc.type}"/>
                </p:column>
                <p:column style="width:15%">
                    <f:facet name="header"></f:facet>

                    <!--Delete button-->
                    <p:commandButton
                        id="delButton"
                        value="#{trans.del}"
                        alt="#{trans.del}"
                        styleClass="ui-button-icon-only secondary small"
                        style="float: right"
                        icon="ui-icon-remove"
                        update="treeTable"
                        oncomplete="delDialog.show()">
                        <f:setPropertyActionListener value="#{doc}"
                                                     target="#{documentsController.selectedDoc}"/>
                    </p:commandButton>

                    <!--Delete dialog-->
                    <p:dialog id="delDialog"
                              header="#{trans.delConfHeader}"
                              widgetVar="delDialog"
                              position="top"
                              closable="false"
                              modal="true">
                        <h:outputText value="#{trans.delConfDial}"/>
                        <br/>
                        <h:outputText value="Name:  #{documentsController.selectedDoc.name} &lt;br/&gt;
                                      Value: #{documentsController.selectedDoc.value} &lt;br/&gt; 
                                      Type:  #{documentsController.selectedDoc.type} &lt;br/&gt;"
                                      escape="false"/>
                        <br/>
                        <p:commandButton
                            id="delOkButton"
                            value="Ok"
                            styleClass="ml20"
                            style="float:right"
                            action="#{documentsController.deleteNode()}"
                            ajax="false"
                            oncomplete="delDialog.hide()"/>

                        <h:outputText value="    "/>

                        <p:commandButton
                            id="delCancelButton"
                            value="#{trans.cancel}"
                            styleClass="secondary"
                            style="float: right"
                            action="cancel"
                            update="treeTable"
                            oncomplete="delDialog.hide()"/>
                    </p:dialog>

                    <!--Edit button-->
                    <p:commandButton id="editButton"
                                     value="#{trans.edit}"
                                     title="#{trans.edit}"
                                     style="float: right"
                                     update="treeTable"
                                     oncomplete="editDialog.show()"
                                     styleClass="ui-button-icon-only secondary small"
                                     icon="ui-icon-edit">
                        <f:setPropertyActionListener value="#{doc}"
                                                     target="#{documentsController.selectedDoc}"/>
                    </p:commandButton>

                    <!--Edit dialog-->
                    <p:dialog id="editDlg"
                              header="#{trans.edit}"
                              widgetVar="editDialog"
                              position="top"
                              resizable="true"
                              showEffect="fade"
                              modal="true">
                        <h:panelGrid id="editPanelGrid" columns="2" cellpadding="4">
                            <h:outputText value="Name:" />
                            <p:inputText  id="inputName" value="#{documentsController.selectedDoc.name}" />
                            <h:outputText value="Value:" rendered="#{not documentsController.selectedDoc.file}"/>
                            <p:inputText  id="inputValue" value="#{documentsController.selectedDoc.value}" rendered="#{not documentsController.selectedDoc.file}"/>
                            <h:outputText value="Type:" rendered="#{not documentsController.selectedDoc.file}"/>
                            <p:selectOneMenu value="#{documentsController.selectedDoc.type}"
                                             id="selectTypeMenu"
                                             rendered="#{not documentsController.selectedDoc.file}">
                                <f:selectItem id="itemString" itemLabel="String" itemValue="String" />
                                <f:selectItem id="itemInteger" itemLabel="Integer" itemValue="Integer" />
                                <f:selectItem id="itemDouble" itemLabel="Double" itemValue="Double" />
                                <f:selectItem id="itemFloat" itemLabel="Float" itemValue="Float" />
                            </p:selectOneMenu>
                        </h:panelGrid>
                        <br/>

                        <p:commandButton
                            id="editOkButton"
                            value="Ok"
                            style="float: right"
                            styleClass="ml20"
                            update="treeTable"
                            ajax="false"
                            oncomplete="editDialog.hide()"
                            actionListener="#{documentsController.editDocument}" />

                        <h:outputText value="    "/>

                        <p:commandButton
                            id="editCancelButton"
                            value="#{trans.cancel}"
                            style="float: right"
                            styleClass="secondary"
                            oncomplete="editDialog.hide()"
                            action="cancel"
                            process="@this"/>                        
                    </p:dialog>                        

                    <!--Add button-->
                    <p:commandButton
                        id="addButton"
                        update="treeTable"
                        rendered="#{doc.file}"
                        oncomplete="addDlg.show()"
                        title="Add new node"
                        styleClass="ui-button-icon-only secondary small"
                        icon="ui-icon-add"
                        style="float: right">
                        <f:setPropertyActionListener value="#{doc}"
                                                     target="#{documentsController.selectedDoc}" />
                    </p:commandButton>

                    <!--Add dialog-->
                    <p:dialog id="addDialog"
                              header="Add Node"
                              position="top"
                              closable="true"
                              showEffect="fade"
                              widgetVar="addDlg"
                              resizable="true"
                              height="auto"
                              width="auto"
                              modal="true">

                        <uib:gridContainer id="container" >
                            <p:selectOneMenu value="#{documentsController.tempDoc.file}" >
                                <f:selectItem itemLabel="Node" itemValue="true" />
                                <f:selectItem itemLabel="Key" itemValue="false" />
                            </p:selectOneMenu>
                            <br/>
                            <p:commandButton
                                id="addOkButton"
                                value="Ok"
                                style="float:right"
                                styleClass="ml20"
                                update="treeTable"
                                oncomplete="addDlg2.show()"/>

                            <h:outputText value="    "/>

                            <p:commandButton
                                id="addCancelButton"
                                value="Cancel"
                                style="float:right"
                                styleClass="secondary"
                                update="treeTable"
                                actionListener="#{documentsController.resetTempDoc()}"
                                oncomplete="addDlg.hide()"/>

                        </uib:gridContainer>
                    </p:dialog>

                    <!--Add dialog 2 edition-->
                    <p:dialog id="addDialog2"
                              header="Add Node"
                              position="top"
                              closable="true"
                              showEffect="fade"
                              widgetVar="addDlg2"
                              resizable="true"
                              height="auto"
                              width="auto"
                              modal="true">
                        <uib:gridContainer id="container2">
                            <h:outputLabel value="Name: " />
                            <p:inputText id="inputName2" value="#{documentsController.tempDoc.name}" style="font-weight:bold" />
                            <h:outputLabel  value="Value: "  rendered="#{not documentsController.tempDoc.file}"/>
                            <p:inputText  id="inputValue2" rendered="#{not documentsController.tempDoc.file}" value="#{documentsController.tempDoc.value}"  style="font-weight:bold" />
                            <h:outputLabel value="Type " rendered="#{not documentsController.tempDoc.file}"/>
                            <p:selectOneMenu  id="selectTypeMenu2" value="#{documentsController.tempDoc.type}" rendered="#{not documentsController.tempDoc.file}">
                                <f:selectItem itemLabel="String" itemValue="String" />
                                <f:selectItem itemLabel="Integer" itemValue="Integer" />
                                <f:selectItem itemLabel="Double" itemValue="Double" />
                                <f:selectItem itemLabel="Float" itemValue="Float" />
                            </p:selectOneMenu>
                            <br/>

                            <p:commandButton value="Ok"
                                             id="addOkButton2"
                                             style="float:right"
                                             styleClass="ml20"
                                             ajax="false"
                                             update="treeTable"
                                             actionListener="#{documentsController.addNode()}"
                                             oncomplete="addDlg2.hide()"/>

                            <h:outputText value="    "/>

                            <p:commandButton value="Cancel"
                                             id="addCancelButton2"
                                             style="float:right"
                                             styleClass="secondary"
                                             update="treeTable"
                                             actionListener="#{documentsController.resetTempDoc()}"
                                             oncomplete="addDlg2.hide()"/>                

                        </uib:gridContainer>
                    </p:dialog>
                </p:column>
            </p:treeTable>
        </h:form>
    </ui:define>
</ui:composition>